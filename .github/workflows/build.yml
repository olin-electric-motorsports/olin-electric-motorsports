name: build

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # Speed things up a bit
    - name: Disable initramfs update
      run: sudo sed -i 's/yes/no/g' /etc/initramfs-tools/update-initramfs.conf
    - name: Disable man-db update
      run: sudo rm -f /var/lib/man-db/auto-update

    # Install avr-gcc
    - name: Install gcc-avr
      run: sudo apt install gcc-avr avr-libc binutils-avr

    - name: Build all host
      run: bazelisk build //...
    - name: Build all ATMega16m1
      run: bazelisk build --config=m16m1-avr //...
    - name: Build all ATMega328p
      run: bazelisk build --config=m328p-avr //...
